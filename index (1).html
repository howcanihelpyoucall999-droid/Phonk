<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Live Messaging App</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;background:#f5f5f5;min-height:100vh;display:flex;justify-content:center;align-items:flex-start}
.container{width:100%;max-width:520px;background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.08);box-sizing:border-box;margin:12px}
h2{text-align:center;margin:6px 0 12px}
h3{margin:14px 0 8px}
input,button,textarea{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;box-sizing:border-box;font-size:15px}
button{background:#007bff;color:#fff;border:none;cursor:pointer;font-weight:600}
button:disabled{background:#ccc;cursor:not-allowed}
.message{padding:8px;border-radius:6px;margin:8px 0}
.success{background:#e6ffef;color:#0b6623;border:1px solid #c9f3d6}
.error{background:#ffecec;color:#8b1a1a;border:1px solid #f5c6c6}
.info{background:#eef6ff;color:#0b3a66;border:1px solid #cfe6ff}
.chat-list-item{display:flex;align-items:center;padding:10px;background:#f0f2f5;margin:6px 0;border-radius:8px;cursor:pointer}
.chat-list-avatar{width:40px;height:40px;border-radius:50%;background:#007bff;color:#fff;display:flex;align-items:center;justify-content:center;margin-right:10px;font-weight:700}
#individual-chat-container{display:none;flex-direction:column;border:1px solid #eee;padding:10px;border-radius:8px;margin-top:8px;background:#fafafa;height:60vh;min-height:360px}
#chat-messages{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:6px;padding-right:6px}
.chat-message{padding:8px 12px;border-radius:14px;max-width:78%;line-height:1.4;word-wrap:break-word}
.chat-message.sent{background:#007bff;color:#fff;align-self:flex-end;margin-left:auto}
.chat-message.received{background:#e8eaf0;color:#111;align-self:flex-start;margin-right:auto}
#chat-input-area{display:flex;gap:8px;margin-top:8px}
#chat-input-area input{flex:1;margin:0}
</style>
</head>
<body>
<div class="container">
<h2>Live Messaging App</h2>

<div id="auth-section">
  <div id="auth-message-area"></div>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="signupBtn">Sign Up</button>
  <button id="loginBtn">Sign In</button>
</div>

<div id="app-section" style="display:none">
  <hr>
  <h3>My Chats</h3>
  <div id="chat-management-area">
    <div id="chat-message-area"></div>
    <input id="addChatEmail" type="email" placeholder="Enter user's email to chat">
    <button id="addChatBtn">Add Person to Chat</button>
  </div>

  <div id="no-chats-message">No active chats. Add someone to start chatting!</div>
  <div id="chat-list-container"></div>

  <div id="individual-chat-container">
    <div id="chat-header" style="display:flex;align-items:center;gap:8px;padding-bottom:8px;border-bottom:1px solid #eee;margin-bottom:8px">
      <button id="backToChatListBtn" style="padding:6px 10px">&lt; Back</button>
      <div id="current-chat-avatar" class="chat-list-avatar"></div>
      <h4 id="current-chat-name" style="margin:0"></h4>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input-area">
      <input id="chatMessageInput" type="text" placeholder="Type a message...">
      <button id="sendChatMessageBtn">Send</button>
      <button id="playGameBtn">ðŸŽ® Play Game</button>
    </div>
  </div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
import { getDatabase, ref as dbRef, set } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";
import { startTicTacToe } from "./tic-tac-toe.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUH95hXYxMVCfhJglN4j3CReXy-CLYwmA",
  authDomain: "live-messageinggkkh.firebaseapp.com",
  databaseURL: "https://live-messageinggkkh-default-rtdb.firebaseio.com",
  projectId: "live-messageinggkkh",
  storageBucket: "live-messageinggkkh.firebasestorage.app",
  messagingSenderId: "537475612761",
  appId: "1:537475612761:web:d00723c117383e54027148"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// Utility functions
function displayMessage(area,msg,type='info'){area.innerHTML=`<div class="message ${type}">${msg}</div>`;setTimeout(()=>area.innerHTML='',4000);}
function showButtonLoading(btn,text){btn.innerText=text;btn.disabled=true;}
function hideButtonLoading(btn){btn.innerText=btn.id==='signupBtn'?'Sign Up':'Sign In';btn.disabled=false;}

// Auth elements
const authMessageArea = document.getElementById('auth-message-area');
const signupBtn = document.getElementById('signupBtn');
const loginBtn = document.getElementById('loginBtn');

signupBtn.onclick = async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!email||!password) return displayMessage(authMessageArea,'Email/password required','error');

  showButtonLoading(signupBtn,'Signing up...'); loginBtn.disabled=true;
  try {
    const userCred = await createUserWithEmailAndPassword(auth,email,password);
    await set(dbRef(db,'users/'+userCred.user.uid),{email,userUid:userCred.user.uid});
    document.getElementById('auth-section').style.display='none';
    document.getElementById('app-section').style.display='block';
  } catch(err) {
    console.error(err);
    displayMessage(authMessageArea,'Sign up failed: '+err.code,'error');
  } finally {
    hideButtonLoading(signupBtn); loginBtn.disabled=false;
  }
};

loginBtn.onclick = async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!email||!password) return displayMessage(authMessageArea,'Email/password required','error');

  showButtonLoading(loginBtn,'Signing in...'); signupBtn.disabled=true;
  try {
    const userCred = await signInWithEmailAndPassword(auth,email,password);
    await set(dbRef(db,'users/'+userCred.user.uid),{email,userUid:userCred.user.uid});
    document.getElementById('auth-section').style.display='none';
    document.getElementById('app-section').style.display='block';
  } catch(err) {
    console.error(err);
    displayMessage(authMessageArea,'Sign in failed: '+err.code,'error');
  } finally {
    hideButtonLoading(loginBtn); signupBtn.disabled=false;
  }
};

onAuthStateChanged(auth,user=>{
  if(user){
    document.getElementById('auth-section').style.display='none';
    document.getElementById('app-section').style.display='block';
  } else {
    document.getElementById('auth-section').style.display='block';
    document.getElementById('app-section').style.display='none';
  }
});

// Game button
document.getElementById('playGameBtn').onclick = startTicTacToe;

</script>
</body>
</html>